(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1038],{1308:function(t,e,n){Promise.resolve().then(n.bind(n,3217))},3217:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return c}});var r,o=n(7311),i=n(6494),a=n(4033),l=n(1298),u=n(2265),s=n(452),c=(r=t=>{let{children:e}=t;return(0,o.tZ)("main",{style:{height:"inherit"},children:e})},t=>{let[e,n]=(0,i.v$)(),c=async()=>{let t=await (0,s.wt)();t?n(t=>({...t,loginState:"login"})):(n(t=>({...t,loginState:"logout"})),(0,s.RN)())};return((0,u.useEffect)(()=>{c()},[]),"login"===e.loginState)?(0,a.redirect)("/room"):"loading"===e.loginState?(0,o.tZ)(l.Z,{}):(0,o.tZ)(r,{...t})})},1298:function(t,e,n){"use strict";n.d(e,{Z:function(){return l}});var r=n(7311);n(2265);var o=n(8067),i=n(3633),a=n.n(i);function l(){return(0,r.tZ)(u,{children:(0,r.tZ)(a(),{type:"spinningBubbles",color:"black"})})}let u=(0,o.Z)("div",{target:"e164e7r10"})("\r\n    height:100%;display:flex;align-items:center;justify-content:center;")},4903:function(t,e,n){"use strict";var r=n(9222);let o=r.default.create({baseURL:"https://codakcodak.site/backapi"});e.Z=o},7262:function(t,e){"use strict";e.Z={onSet(t,e){let n=JSON.stringify(e);localStorage.setItem(String(t),n)},onGet(t){var e;let n=null!==(e=localStorage.getItem(String(t)))&&void 0!==e?e:"null";try{return JSON.parse(n)}catch(t){return n}}}},6494:function(t,e,n){"use strict";n.d(e,{B1:function(){return i},EE:function(){return l},sB:function(){return a},v$:function(){return c},wy:function(){return u},zV:function(){return s},zW:function(){return d}});var r=n(6881),o=n(7262);let i="@user/token",a="@user/info",l="@user/room",u="@user/friend",s="@user/image",c=(0,r.MT)({key:a,initial:{loginState:"loading"},persistor:o.Z}),d=(0,r.MT)({key:"".concat(s,"-imagelist"),initial:null})},2472:function(t,e,n){"use strict";n.d(e,{L:function(){return l}});var r=n(9222),o=n(2164),i=n(7262),a=n(6494);let l=async()=>{try{let t=new Date,e=i.Z.onGet(a.B1),n=null==e?void 0:e.access_token,o=null==e?void 0:e.refresh_token,l=null==e?void 0:e.access_token_expire_time,u=null==e?void 0:e.refresh_token_expire_time;if(!l||!u||!n)return null;let s=new Date(l),c=s.getTime()-t.getTime(),d=new Date(u),f=d.getTime()-t.getTime();if(c>=3e4)return e;if(!(f>=3e4))return null;{let t=i.Z.onGet(a.sB),n=null==t?void 0:t.user_info.id,l=await r.default.post("/backapi/user/".concat(n,"/refresh"),{refresh_token:o}),u=l.data;return i.Z.onSet(a.B1,{...e,...u}),u}}catch(t){return t instanceof o.d7?console.error("Error: 사용자 권한을 갱신하지 못하였습니다..",t):console.error("Error: ",t),null}}},452:function(t,e,n){"use strict";n.d(e,{R5:function(){return s},RN:function(){return c},eu:function(){return d},wt:function(){return f},x4:function(){return u}});var r=n(7262),o=n(6494),i=n(2164),a=n(4903),l=n(2472);let u=async t=>{let{email:e,password:n}=t;try{let t=await a.Z.post("/user/login",{email:e,password:n}),i=t.data;return r.Z.onSet(o.B1,i),!0}catch(t){if(t instanceof i.d7){var l,u,s;(null===(l=t.response)||void 0===l?void 0:l.status)===401||(null===(u=t.response)||void 0===u?void 0:u.status)===404?alert(null===(s=t.response)||void 0===s?void 0:s.data.message):alert("서버 문제로 잠시 후에 다시 시도 해주세요.")}else alert("예기치 못한 에러가 발생하였습니다..다시 시도해주세요.")}},s=async(t,e)=>{try{let n=await a.Z.get("/oauth-login/callback?coperation=".concat(t,"&code=").concat(e)),{user_id:i,...l}=n.data,u=await a.Z.get("/user/my",{headers:{Authorization:null==l?void 0:l.access_token}});r.Z.onSet(o.B1,l);let s=u.data.user_info;return s}catch(t){t instanceof i.d7?alert("서버 문제로 잠시 후에 다시 시도 해주세요."):alert("예기치 못한 에러가 발생하였습니다..다시 시도해주세요.");return}},c=()=>{window.localStorage.removeItem(o.sB),window.localStorage.removeItem(o.B1),window.localStorage.removeItem(o.EE),window.localStorage.removeItem(o.wy),window.localStorage.removeItem(o.zV)},d=async t=>{var e;try{let e=await (0,l.L)(),n=await a.Z.post("/user/my",{name:t},{headers:{Authorization:null==e?void 0:e.access_token}});return alert("성공적으로 변경하였습니다!"),n.data}catch(t){t instanceof i.d7?(null===(e=t.response)||void 0===e?void 0:e.status)===401?alert("사용자 권한이 없습니다..로그아웃 후 시도해주세요."):alert("서버 문제로 잠시 후에 다시 시도 해주세요."):alert("예기치 못한 에러가 발생하였습니다..다시 시도해주세요.")}},f=async()=>{var t;try{let t=await (0,l.L)();if(!t)throw Error();let e=await a.Z.get("/user/my",{headers:{Authorization:null==t?void 0:t.access_token}});return e.data.user_info}catch(e){return e instanceof i.d7&&((null===(t=e.response)||void 0===t?void 0:t.status)===401?console.error("Auth Error: ",e):console.error("Server Error: ",e)),null}}},4033:function(t,e,n){t.exports=n(8165)}},function(t){t.O(0,[7311,6881,2164,3852,2971,596,1744],function(){return t(t.s=1308)}),_N_E=t.O()}]);