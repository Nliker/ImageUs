(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2085],{8658:function(e,t,r){Promise.resolve().then(r.bind(r,4621))},4621:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(7311),o=r(2265),a=r(4033),i=r(6494),u=r(452);function l(){let[,e]=(0,i.v$)(),t=(0,a.useSearchParams)(),r=async(t,r)=>{e({loginState:"loading"});let n=await (0,u.R5)(t,r);e(e=>({...e,loginState:"login",user_info:n}))};return(0,o.useEffect)(()=>{let e=t.get("coperation"),n=t.get("code");e&&n&&r(e,n)},[t]),(0,n.tZ)("div",{children:"로그인 요청 처리중.."})}},4903:function(e,t,r){"use strict";var n=r(9222);let o=n.default.create({baseURL:"https://codakcodak.site/backapi"});t.Z=o},7262:function(e,t){"use strict";t.Z={onSet(e,t){let r=JSON.stringify(t);localStorage.setItem(String(e),r)},onGet(e){var t;let r=null!==(t=localStorage.getItem(String(e)))&&void 0!==t?t:"null";try{return JSON.parse(r)}catch(e){return r}}}},6494:function(e,t,r){"use strict";r.d(t,{B1:function(){return a},EE:function(){return u},sB:function(){return i},v$:function(){return c},wy:function(){return l},zV:function(){return s},zW:function(){return d}});var n=r(6881),o=r(7262);let a="@user/token",i="@user/info",u="@user/room",l="@user/friend",s="@user/image",c=(0,n.MT)({key:i,initial:{loginState:"loading"},persistor:o.Z}),d=(0,n.MT)({key:"".concat(s,"-imagelist"),initial:null})},2472:function(e,t,r){"use strict";r.d(t,{L:function(){return u}});var n=r(9222),o=r(2164),a=r(7262),i=r(6494);let u=async()=>{try{let e=new Date,t=a.Z.onGet(i.B1),r=null==t?void 0:t.access_token,o=null==t?void 0:t.refresh_token,u=null==t?void 0:t.access_token_expire_time,l=null==t?void 0:t.refresh_token_expire_time;if(!u||!l||!r)return null;let s=new Date(u),c=s.getTime()-e.getTime(),d=new Date(l),f=d.getTime()-e.getTime();if(c>=3e4)return t;if(!(f>=3e4))return null;{let e=a.Z.onGet(i.sB),r=null==e?void 0:e.user_info.id,u=await n.default.post("/backapi/user/".concat(r,"/refresh"),{refresh_token:o}),l=u.data;return a.Z.onSet(i.B1,{...t,...l}),l}}catch(e){return e instanceof o.d7?console.error("Error: 사용자 권한을 갱신하지 못하였습니다..",e):console.error("Error: ",e),null}}},452:function(e,t,r){"use strict";r.d(t,{R5:function(){return s},RN:function(){return c},eu:function(){return d},wt:function(){return f},x4:function(){return l}});var n=r(7262),o=r(6494),a=r(2164),i=r(4903),u=r(2472);let l=async e=>{let{email:t,password:r}=e;try{let e=await i.Z.post("/user/login",{email:t,password:r}),a=e.data;return n.Z.onSet(o.B1,a),!0}catch(e){if(e instanceof a.d7){var u,l,s;(null===(u=e.response)||void 0===u?void 0:u.status)===401||(null===(l=e.response)||void 0===l?void 0:l.status)===404?alert(null===(s=e.response)||void 0===s?void 0:s.data.message):alert("서버 문제로 잠시 후에 다시 시도 해주세요.")}else alert("예기치 못한 에러가 발생하였습니다..다시 시도해주세요.")}},s=async(e,t)=>{try{let r=await i.Z.get("/oauth-login/callback?coperation=".concat(e,"&code=").concat(t)),{user_id:a,...u}=r.data,l=await i.Z.get("/user/my",{headers:{Authorization:null==u?void 0:u.access_token}});n.Z.onSet(o.B1,u);let s=l.data.user_info;return s}catch(e){e instanceof a.d7?alert("서버 문제로 잠시 후에 다시 시도 해주세요."):alert("예기치 못한 에러가 발생하였습니다..다시 시도해주세요.");return}},c=()=>{window.localStorage.removeItem(o.sB),window.localStorage.removeItem(o.B1),window.localStorage.removeItem(o.EE),window.localStorage.removeItem(o.wy),window.localStorage.removeItem(o.zV)},d=async e=>{var t;try{let t=await (0,u.L)(),r=await i.Z.post("/user/my",{name:e},{headers:{Authorization:null==t?void 0:t.access_token}});return alert("성공적으로 변경하였습니다!"),r.data}catch(e){e instanceof a.d7?(null===(t=e.response)||void 0===t?void 0:t.status)===401?alert("사용자 권한이 없습니다..로그아웃 후 시도해주세요."):alert("서버 문제로 잠시 후에 다시 시도 해주세요."):alert("예기치 못한 에러가 발생하였습니다..다시 시도해주세요.")}},f=async()=>{var e;try{let e=await (0,u.L)();if(!e)throw Error();let t=await i.Z.get("/user/my",{headers:{Authorization:null==e?void 0:e.access_token}});return t.data.user_info}catch(t){return t instanceof a.d7&&((null===(e=t.response)||void 0===e?void 0:e.status)===401?console.error("Auth Error: ",t):console.error("Server Error: ",t)),null}}},4033:function(e,t,r){e.exports=r(8165)}},function(e){e.O(0,[7311,6881,2164,2971,596,1744],function(){return e(e.s=8658)}),_N_E=e.O()}]);