"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1122],{1122:function(e,t,r){r.d(t,{Z:function(){return v}});var n=r(7311),a=r(2265),i=r(4033),o=r(6691),l=r.n(o),s=r(1172),c=r(1697),u=r(9348),d=r(442),f=r(8067),g=r(5124),p=r(9509),m=r(8427);let h=["image/HEIF","image/heif","image/JPEG","image/jpeg","image/JPG","image/jpg","image/GIF","image/gif","image/PDF","image/pdf","image/PNG","image/png"];function v(e){let{roomId:t}=e,r=(0,i.useRouter)(),{uploadRoomImage:o,uploadUserImage:f}=(0,g.d)(),[v,b]=(0,a.useState)(null),[y,k,x]=(0,d.Z)(""),[_,Z]=(0,a.useState)(!1),[L,j]=(0,a.useState)(null),z=(0,a.useRef)(null),E=async()=>{v&&(t?await o(t,v):await f(v)),r.back()};return(0,n.tZ)(m.Z,{children:(0,n.BX)(w,{children:[(0,n.tZ)("div",{className:"title",children:"이미지 업로드"}),(0,n.tZ)("div",{className:"preview",onDrop:e=>{e.preventDefault();let t=new FormData;if(e.dataTransfer.items)for(let r=0;r<e.dataTransfer.items.length;r++)if("file"===e.dataTransfer.items[r].kind&&h.includes(e.dataTransfer.items[r].type)){let n=e.dataTransfer.items[r].getAsFile();t.append("image",n)}else{alert("jpg, png, pdf, gif, jpeg, heif 형식만 업로드 가능합니다.");return}else for(let r=0;r<e.dataTransfer.files.length;r++)if(h.includes(e.dataTransfer.files[r].type))t.append("image",e.dataTransfer.files[r]);else{alert("jpg, png, pdf, gif, jpeg, heif 형식만 업로드 가능합니다.");return}let r=new Image,n=t.get("image");r.src=URL.createObjectURL(n),k(n.name),j(r),b(t),Z(!1)},onDragOver:e=>{e.preventDefault(),Z(!0)},ref:z,children:(0,n.tZ)(s.Pd.Provider,{value:{size:"60px"},children:_?(0,n.tZ)("div",{className:"upload_cover",children:(0,n.tZ)(u.cmt,{})}):L?(0,n.tZ)(l(),{src:L.src,alt:"미리보기 이미지",style:{width:"100%",height:"100%",objectFit:"contain"},width:300,height:300}):(0,n.BX)("div",{className:"preview_icon_box",children:[(0,n.tZ)(c.BJX,{}),(0,n.tZ)("p",{children:"이미지를 올려놓으세요"})]})})}),(0,n.BX)("div",{className:"file_search",children:[(0,n.tZ)("input",{className:"upload_name",value:y,placeholder:"첨부파일",readOnly:!0}),(0,n.tZ)("label",{htmlFor:"file",children:"파일찾기"}),(0,n.tZ)("input",{type:"file",id:"file",onChange:e=>{let t=new FormData;if(e.target.files){if(0===e.target.files.length)return;for(let r=0;r<e.target.files.length;r++)if(h.includes(e.target.files[r].type))t.append("image",e.target.files[r]),k(e.target.files[r].name);else{alert("jpg, png, pdf, gif, jpeg, heif 형식만 업로드 가능합니다.");return}let r=new Image;r.src=URL.createObjectURL(t.get("image")),j(r),b(t)}}})]}),(0,n.BX)("div",{className:"button_group",children:[(0,n.tZ)(p.z,{onClick:E,children:"업로드"}),(0,n.tZ)(p.z,{onClick:()=>r.back(),children:"취소"})]})]})})}let w=(0,f.Z)("div",{target:"e1zvsee0"})('\r\n    display:flex;flex-direction:column;height:100%;padding:1.5rem;box-sizing:border-box;.title{margin-bottom:10px;text-align:center;font-size:1.2rem;}.preview{flex:1 0 auto;display:flex;flex-direction:column;align-items:center;justify-content:center;max-height:300px;color:hsla(240,7%,70%,1);user-select:none;.preview_icon_box{display:flex;flex-direction:column;align-items:center;}}.file_search{display:flex;justify-content:center;margin:15px 0;.upload_name{display:inline-block;height:40px;padding:0 10px;vertical-align:middle;border:1px solid #dddddd;width:60%;color:#999999;}label{display:inline-block;padding:10px 20px;color:#fff;vertical-align:middle;background-color:#999999;cursor:pointer;margin-left:10px;white-space:nowrap;}input[type="file"]{position:absolute;width:0;height:0;padding:0;overflow:hidden;border:0;}}.button_group{display:flex;justify-content:space-evenly;}')},9509:function(e,t,r){r.d(t,{z:function(){return a}});var n=r(8067);let a=(0,n.Z)("button",{target:"e8c3pr40"})("\r\n    -webkit-appearance:none;-moz-appearance:none;appearance:none;background:","#446cb3",";color:","#ffffff",";margin:0;padding:0.5rem 1rem;font-size:1rem;font-weight:400;text-align:center;text-decoration:none;border:none;border-radius:4px;display:inline-block;width:auto;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);cursor:pointer;transition:0.5s;&:hover,&:active,&:focus{background:","#365690",";outline:0;}&:disabled{opacity:0.5;}&.success{background:","#28a745",";&:hover,&:active,&:focus{background:","#218838",";outline:0;}&:disabled{opacity:0.5;}}&.error{background:","#dc3545",";&:hover,&:active,&:focus{background:","#c82333",";outline:0;}&:disabled{opacity:0.5;}}&.warning{color:","#212529",";background:","#ffc107",";&:hover,&:active,&:focus{background:","#e0a800",";outline:0;}&:disabled{opacity:0.5;}}")},8427:function(e,t,r){var n=r(7311),a=r(2265),i=r(8067),o=r(4033),l=r(7263);let s=(0,i.Z)("div",{target:"e1yx7v2l0"})("\r\n    display:flex;justify-content:center;align-items:center;position:absolute;left:0;right:0;top:0;bottom:0;z-index:100;overflow:hidden;background-color:rgb(0,0,0,0.65);"),c=(0,i.Z)("div",{target:"e1yx7v2l1"})("\r\n    position:relative;width:",e=>{let{width:t}=e;return null!=t?t:"70%"},";height:",e=>{let{height:t}=e;return null!=t?t:"70%"},";max-width:550px;box-sizing:border-box;border-radius:10px;background:#fff;box-shadow:0 30px 60px 0 rgba(90,116,148,0.4);");t.Z=e=>{let{children:t,scroll:r=!0,width:i,height:u}=e,d=(0,a.useRef)(null),f=(0,o.useRouter)(),g=(0,a.useCallback)(()=>{f.back()},[f]),p=(0,a.useCallback)(e=>{e.target===d.current&&g&&g()},[g,d]);return(0,n.tZ)(s,{ref:d,onClick:p,children:(0,n.tZ)(c,{width:i,height:u,children:r?(0,n.tZ)(l.ZP,{children:t}):t})})}},5124:function(e,t,r){r.d(t,{d:function(){return f}});var n=r(4903),a=r(6494),i=r(9222),o=r(2164),l=r(6881),s=r(5476),c=r(6339),u=r(2472);async function d(e){try{let t=await (0,u.L)(),r=e.filter(e=>e.link&&e.user_id),n=[],a=i.default.create({baseURL:"https://codakcodak.site"});a.interceptors.response.use(void 0,e=>{var t;let r=e.config;r.retryCount=null!==(t=r.retryCount)&&void 0!==t?t:0;let n=r.retryCount<2;return n?(r.retryCount+=1,r.headers={...r.headers},a.request(r)):Promise.reject(e)});let o=await Promise.allSettled(r.map(async e=>{let r={url:"/imageapi/image-download/".concat(e.link),method:"GET",headers:{Authorization:t.access_token},responseType:"blob"},n=await a.request(r),i=null!==e.created_at?e.created_at.split(" ")[0]:null,o=window.URL.createObjectURL(new Blob([n.data],{type:n.headers["content-type"]})),l=e.link?e.link.split("/")[1]:"Image";return{...e,link:o,fileName:l,created_at:i}}));return o.forEach(e=>{"fulfilled"===e.status&&n.push(e.value)}),n}catch(e){throw e}}function f(){let[e,t]=(0,a.v$)(),[,r]=(0,s.W)(),[,i]=(0,a.zW)(),[f,g]=(0,l.ZP)({key:"".concat(s.H,"-loading"),initial:!0}),[p,m]=(0,l.ZP)({key:"".concat(s.H,"-loadend"),initial:!1}),h=async(e,t)=>{try{g(!0);let r=await (0,u.L)(),a=await n.Z.get("/user/".concat(e,"/imagelist?start=").concat(t,"&limit=").concat(12),{headers:{Authorization:r.access_token}}),i=a.data.imagelist,o=await d(i);return o.length<12&&m(!0),g(!1),o}catch(e){if(e instanceof o.d7){var r,a;(null===(r=e.response)||void 0===r?void 0:r.status)===401||(null===(a=e.response)||void 0===a?void 0:a.status)===403?console.error("Error: 올바른 요청이 아닙니다..다시시도 해주세요!"):console.error("Error: 이미지를 불러오는데 실패하였습니다..다시 시도해주세요")}else throw new c.U7}},v=async e=>{try{let r=await (0,u.L)();await n.Z.delete("/image",{headers:{Authorization:r.access_token},data:{delete_image_id:e}}),alert("이미지를 성공적으로 삭제하였습니다!"),i(t=>{if(!t)return null;let r=t.filter(t=>t.id!==e);return r}),t(e=>({...e,imageLen:(null==e?void 0:e.imageLen)?e.imageLen-1:null==e?void 0:e.imageLen}))}catch(e){if(e instanceof o.d7){var r,a;(null===(r=e.response)||void 0===r?void 0:r.status)===401||(null===(a=e.response)||void 0===a?void 0:a.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지를 삭제하는데 실패하였습니다..다시 시도해주세요")}else throw new c.U7}},w=async e=>{try{let r=await (0,u.L)(),a=await n.Z.post("/image",e,{headers:{Authorization:r.access_token}}),o=a.data.image_info,l=null!==o.created_at?o.created_at.split(" ")[0]:null,s=window.URL.createObjectURL(new Blob([e.get("image")],{type:"multipart/form-data"})),c=o.link?o.link.split("/")[1]:"Image",d={...a.data.image_info,created_at:l,link:s,fileName:c};alert("이미지를 성공적으로 업로드하였습니다!"),i(e=>e?[d,...e]:[d]),t(e=>({...e,imageLen:(null==e?void 0:e.imageLen)?e.imageLen+1:null==e?void 0:e.imageLen}))}catch(e){if(e instanceof o.d7){var r,a;(null===(r=e.response)||void 0===r?void 0:r.status)===401||(null===(a=e.response)||void 0===a?void 0:a.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지 업로드에 실패하였습니다..다시 시도해주세요")}else throw new c.U7}},b=async(e,t)=>{try{g(!0);let r=await (0,u.L)(),a=await n.Z.get("/room/".concat(e,"/imagelist?start=").concat(t,"&limit=").concat(12),{headers:{Authorization:r.access_token}}),i=a.data.imagelist,o=await d(i);return o.length<12&&m(!0),g(!1),o}catch(e){if(e instanceof o.d7){var r,a;(null===(r=e.response)||void 0===r?void 0:r.status)===401||(null===(a=e.response)||void 0===a?void 0:a.status)===403?console.error("Error: 올바른 요청이 아닙니다..다시시도 해주세요!"):console.error("Error: ","이미지를 불러오는데 실패하였습니다..다시 시도해주세요")}else throw new c.U7}},y=async(e,t)=>{try{let a=await (0,u.L)();await n.Z.delete("/room/".concat(e,"/image"),{headers:{Authorization:a.access_token},data:{delete_room_image_id:t}}),alert("이미지를 성공적으로 삭제하였습니다!"),r(e=>{if(!e)return null;let r=e.filter(e=>e.id!==t);return r})}catch(e){if(e instanceof o.d7){var a,i;(null===(a=e.response)||void 0===a?void 0:a.status)===401||(null===(i=e.response)||void 0===i?void 0:i.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지를 삭제하는데 실패하였습니다..다시 시도해주세요")}else throw new c.U7}},k=async(t,a)=>{var i,l,s;try{let o=await (0,u.L)(),l=await n.Z.post("/room/".concat(t,"/image"),a,{headers:{Authorization:o.access_token}}),s=l.data.image_info,c=null!==s.created_at?s.created_at.split(" ")[0]:null,d=window.URL.createObjectURL(new Blob([a.get("image")],{type:"multipart/form-data"})),f=s.link?s.link.split("/")[1]:"Image",g={...l.data.image_info,created_at:c,link:d,fileName:f,user_name:null===(i=e.user_info)||void 0===i?void 0:i.name};alert("이미지를 성공적으로 업로드하였습니다!"),r(e=>e?[g,...e]:[g])}catch(e){if(e instanceof o.d7)(null===(l=e.response)||void 0===l?void 0:l.status)===401||(null===(s=e.response)||void 0===s?void 0:s.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지 업로드에 실패하였습니다..다시 시도해주세요");else throw new c.U7}};return{isLoading:f,imageLoadEnd:p,setImageLoadEnd:m,loadUserImagelist:h,deleteUserImage:v,uploadUserImage:w,loadRoomImagelist:b,deleteRoomImage:y,uploadRoomImage:k}}},442:function(e,t,r){var n=r(2265);t.Z=e=>{let[t,r]=(0,n.useState)(e),a=(0,n.useCallback)(e=>{r(e.target.value)},[]);return[t,r,a]}},4903:function(e,t,r){var n=r(9222);let a=n.default.create({baseURL:"https://codakcodak.site/backapi"});t.Z=a},6339:function(e,t,r){r.d(t,{F7:function(){return n},U7:function(){return a}});class n extends Error{constructor(e="연결되 네트워크가 없습니다."){super(e),this.name="NetworkError"}}class a extends Error{constructor(e="예기치 못한 에러가 발생하였습니다..다시 시도해주세요."){super(e),this.name="unknownError"}}},7262:function(e,t){t.Z={onSet(e,t){let r=JSON.stringify(t);localStorage.setItem(String(e),r)},onGet(e){var t;let r=null!==(t=localStorage.getItem(String(e)))&&void 0!==t?t:"null";try{return JSON.parse(r)}catch(e){return r}}}},5476:function(e,t,r){r.d(t,{H:function(){return a},W:function(){return i}});var n=r(6881);let a="@room/image",i=(0,n.MT)({key:"".concat(a,"-imagelist"),initial:null})},6494:function(e,t,r){r.d(t,{B1:function(){return i},EE:function(){return l},sB:function(){return o},v$:function(){return u},wy:function(){return s},zV:function(){return c},zW:function(){return d}});var n=r(6881),a=r(7262);let i="@user/token",o="@user/info",l="@user/room",s="@user/friend",c="@user/image",u=(0,n.MT)({key:o,initial:{loginState:"loading"},persistor:a.Z}),d=(0,n.MT)({key:"".concat(c,"-imagelist"),initial:null})},2472:function(e,t,r){r.d(t,{L:function(){return l}});var n=r(9222),a=r(2164),i=r(7262),o=r(6494);let l=async()=>{try{let e=new Date,t=i.Z.onGet(o.B1),r=null==t?void 0:t.access_token,a=null==t?void 0:t.refresh_token,l=null==t?void 0:t.access_token_expire_time,s=null==t?void 0:t.refresh_token_expire_time;if(!l||!s||!r)return null;let c=new Date(l),u=c.getTime()-e.getTime(),d=new Date(s),f=d.getTime()-e.getTime();if(u>=3e4)return t;if(!(f>=3e4))return null;{let e=i.Z.onGet(o.sB),r=null==e?void 0:e.user_info.id,l=await n.default.post("/backapi/user/".concat(r,"/refresh"),{refresh_token:a}),s=l.data;return i.Z.onSet(o.B1,{...t,...s}),s}}catch(e){return e instanceof a.d7?console.error("Error: 사용자 권한을 갱신하지 못하였습니다..",e):console.error("Error: ",e),null}}},1172:function(e,t,r){r.d(t,{w_:function(){return s},Pd:function(){return i}});var n=r(2265),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=n.createContext&&n.createContext(a),o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},l=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r};function s(e){return function(t){return n.createElement(c,o({attr:o({},e.attr)},t),function e(t){return t&&t.map(function(t,r){return n.createElement(t.tag,o({key:r},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var r,a=e.attr,i=e.size,s=e.title,c=l(e,["attr","size","title"]),u=i||t.size||"1em";return t.className&&(r=t.className),e.className&&(r=(r?r+" ":"")+e.className),n.createElement("svg",o({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,a,c,{className:r,style:o(o({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),s&&n.createElement("title",null,s),e.children)};return void 0!==i?n.createElement(i.Consumer,null,function(e){return t(e)}):t(a)}}}]);