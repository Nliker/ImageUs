"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5009],{8615:function(e,t,n){n.d(t,{Z:function(){return m}});var o=n(7311);n(2265);var r=n(6691),i=n.n(r),a=n(4033),l=n(1172),c=n(6820),s=n(8067),d=n(6494),u=n(4616),f=n(9150),p=n(5124);function h(e){let{isRoom:t,imageId:n}=e,r=(0,a.useParams)(),{deleteRoomImage:i,deleteUserImage:l}=(0,p.d)();return(0,o.tZ)(u.Z,{id:n,icon:(0,o.tZ)(f.VPh,{}),title:"주의!",content:"정말 이미지를 삭제하시겠습니까?",okHandler:()=>{t?i(r.id,n):l(n)}})}function m(e){var t;let{imageData:n,observerRef:r}=e,s=(0,a.useRouter)(),u=(0,a.useParams)(),f=(0,a.usePathname)(),[p]=(0,d.v$)();return(0,o.BX)(g,{ref:r,children:[(0,o.tZ)("div",{className:"image_box",onClick:()=>s.push("".concat(f,"/detail_photo/").concat(n.id)),children:(0,o.tZ)(i(),{src:n.link,alt:n.fileName+" 이미지",style:{width:"100%",height:"100%",objectFit:"cover"},width:300,height:300})}),(0,o.tZ)(l.Pd.Provider,{value:{size:"22px",color:"rgba(0, 0, 0, 0.88)",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}},children:(0,o.BX)("div",{className:"button_box",children:[(0,o.tZ)("div",{className:"download_btn",children:(0,o.tZ)("a",{href:n.link,download:n.fileName,children:(0,o.tZ)(c.yf7,{})})}),(null==p?void 0:null===(t=p.user_info)||void 0===t?void 0:t.id)===n.user_id&&(0,o.tZ)(h,{isRoom:null!=u&&!!u.id,imageId:n.id})]})})]})}let g=(0,s.Z)("div",{target:"e78wwbe0"})("\r\n    display:flex;flex-direction:column;position:relative;box-sizing:border-box;height:250px;margin:0;padding:0;border:1px solid #f0f0f0;border-radius:8px;font-size:14px;color:rgba(0,0,0,0.88);transition:box-shadow 0.2s,border-color 0.2s;background:#fff;cursor:pointer;overflow:hidden;&:hover{border-color:transparent;box-shadow:0 1px 2px -2px rgba(0,0,0,0.16),0 3px 6px 0 rgba(0,0,0,0.12),0 5px 12px 4px rgba(0,0,0,0.09);}.image_box{display:flex;flex:4;overflow:hidden;}.button_box{display:flex;flex:1;& > div{position:relative;flex:1;}.download_btn{border-right:1px solid #f0f0f0;&:hover{background-color:#f0f0f0;}& > a{display:inline-block;width:100%;height:100%;}}}")},2046:function(e,t,n){n.d(t,{Z:function(){return s}});var o=n(7311),r=n(606),i=n.n(r);n(2265);var a=n(3633),l=n.n(a),c=n(8067);function s(){return(0,o.tZ)(d,{children:(0,o.tZ)("div",{className:"circle_box",children:(0,o.BX)("div",{className:"text_box",children:[(0,o.tZ)("span",{className:"".concat(i().className," text"),children:"Loading..."}),(0,o.tZ)(l(),{type:"cylon",color:"#363745",className:"loading"})]})})})}let d=(0,c.Z)("div",{target:"ellqkn20"})("\r\n    display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;color:#363745;.circle_box{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100px;height:100px;padding:2rem;border-radius:50%;background-color:#f8f8ff;.text_box{position:relative;.text{font-size:1.2rem;}.loading{position:absolute;top:20px;left:50%;transform:translateX(-50%);}}}")},4616:function(e,t,n){n.d(t,{Z:function(){return i}});var o=n(7311);n(2265);var r=n(8067);function i(e){let{id:t,icon:n,title:r,content:i,okHandler:l}=e;return(0,o.BX)(a,{idNum:t,children:[(0,o.tZ)("input",{id:"modal_toggle_".concat(t),type:"checkbox"}),(0,o.tZ)("label",{htmlFor:"modal_toggle_".concat(t),className:"label_icon",children:n}),(0,o.tZ)("label",{className:"modal_backdrop",htmlFor:"modal_toggle_".concat(t)}),(0,o.BX)("div",{className:"modal_content",children:[(0,o.tZ)("label",{className:"modal_close",htmlFor:"modal_toggle_".concat(t),children:"✕"}),(0,o.tZ)("h2",{children:r}),(0,o.tZ)("hr",{}),(0,o.tZ)("p",{className:"modal_content_text",children:i}),(0,o.tZ)("label",{className:"modal_content_btn ok_button",onClick:l,htmlFor:"modal_toggle_".concat(t),children:"확인"}),(0,o.tZ)("label",{className:"modal_content_btn",htmlFor:"modal_toggle_".concat(t),children:"취소"})]})]})}let a=(0,r.Z)("div",{target:"e9y1uwz0"})("\r\n    flex:1;display:flex;align-items:center;justify-content:center;width:100%;&:hover{background-color:#f07070;svg{color:white !important;}}.label_icon{display:flex;width:100%;height:100%;justify-content:center;align-items:center;cursor:pointer;}#modal_toggle_",e=>{let{idNum:t}=e;return t},"{display:none;}.modal_content,.modal_backdrop{height:0;width:0;opacity:0;visibility:hidden;overflow:hidden;cursor:pointer;transition:opacity 0.2s ease-in;}.modal_content{.modal_content_text{margin-top:2rem;text-align:center;font-size:18px;}.modal_close{color:#aaa;position:absolute;right:5px;top:5px;padding-top:3px;background:#fff;font-size:16px;width:25px;height:25px;font-weight:bold;text-align:center;cursor:pointer;&:hover{color:#333;}}.modal_content_btn{position:absolute;text-align:center;cursor:pointer;bottom:20px;right:30px;background:#446cb3;color:#fff;width:50px;border-radius:2px;font-size:14px;height:32px;padding-top:9px;font-weight:normal;&:hover{color:#fff;background:#365690;}}.ok_button{margin-right:75px;}}#modal_toggle_",e=>{let{idNum:t}=e;return t},".active ~ .modal_backdrop,#modal_toggle_",e=>{let{idNum:t}=e;return t},":checked ~ .modal_backdrop{background-color:rgba(0,0,0,0.6);width:100vw;height:100vh;position:fixed;left:0;top:0;z-index:9;visibility:visible;opacity:1;transition:opacity 0.2s ease-in;}#modal_toggle_",e=>{let{idNum:t}=e;return t},".active ~ .modal_content,#modal_toggle_",e=>{let{idNum:t}=e;return t},":checked ~ .modal_content{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:999;max-width:400px;width:300px;height:230px;padding:10px 30px;opacity:1;border-radius:4px;background-color:#fff;box-shadow:0 3px 7px rgba(0,0,0,0.6);cursor:auto;pointer-events:auto;visibility:visible;}")},5124:function(e,t,n){n.d(t,{d:function(){return f}});var o=n(4903),r=n(6494),i=n(9222),a=n(2164),l=n(6881),c=n(5476),s=n(6339),d=n(2472);async function u(e){try{let t=await (0,d.L)(),n=e.filter(e=>e.link&&e.user_id),o=[],r=i.default.create({baseURL:"https://codakcodak.site"});r.interceptors.response.use(void 0,e=>{var t;let n=e.config;n.retryCount=null!==(t=n.retryCount)&&void 0!==t?t:0;let o=n.retryCount<2;return o?(n.retryCount+=1,n.headers={...n.headers},r.request(n)):Promise.reject(e)});let a=await Promise.allSettled(n.map(async e=>{let n={url:"/imageapi/image-download/".concat(e.link),method:"GET",headers:{Authorization:t.access_token},responseType:"blob"},o=await r.request(n),i=null!==e.created_at?e.created_at.split(" ")[0]:null,a=window.URL.createObjectURL(new Blob([o.data],{type:o.headers["content-type"]})),l=e.link?e.link.split("/")[1]:"Image";return{...e,link:a,fileName:l,created_at:i}}));return a.forEach(e=>{"fulfilled"===e.status&&o.push(e.value)}),o}catch(e){throw e}}function f(){let[e,t]=(0,r.v$)(),[,n]=(0,c.W)(),[,i]=(0,r.zW)(),[f,p]=(0,l.ZP)({key:"".concat(c.H,"-loading"),initial:!0}),[h,m]=(0,l.ZP)({key:"".concat(c.H,"-loadend"),initial:!1}),g=async(e,t)=>{try{p(!0);let n=await (0,d.L)(),r=await o.Z.get("/user/".concat(e,"/imagelist?start=").concat(t,"&limit=").concat(12),{headers:{Authorization:n.access_token}}),i=r.data.imagelist,a=await u(i);return a.length<12&&m(!0),p(!1),a}catch(e){if(e instanceof a.d7){var n,r;(null===(n=e.response)||void 0===n?void 0:n.status)===401||(null===(r=e.response)||void 0===r?void 0:r.status)===403?console.error("Error: 올바른 요청이 아닙니다..다시시도 해주세요!"):console.error("Error: 이미지를 불러오는데 실패하였습니다..다시 시도해주세요")}else throw new s.U7}},v=async e=>{try{let n=await (0,d.L)();await o.Z.delete("/image",{headers:{Authorization:n.access_token},data:{delete_image_id:e}}),alert("이미지를 성공적으로 삭제하였습니다!"),i(t=>{if(!t)return null;let n=t.filter(t=>t.id!==e);return n}),t(e=>({...e,imageLen:(null==e?void 0:e.imageLen)?e.imageLen-1:null==e?void 0:e.imageLen}))}catch(e){if(e instanceof a.d7){var n,r;(null===(n=e.response)||void 0===n?void 0:n.status)===401||(null===(r=e.response)||void 0===r?void 0:r.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지를 삭제하는데 실패하였습니다..다시 시도해주세요")}else throw new s.U7}},_=async e=>{try{let n=await (0,d.L)(),r=await o.Z.post("/image",e,{headers:{Authorization:n.access_token}}),a=r.data.image_info,l=null!==a.created_at?a.created_at.split(" ")[0]:null,c=window.URL.createObjectURL(new Blob([e.get("image")],{type:"multipart/form-data"})),s=a.link?a.link.split("/")[1]:"Image",u={...r.data.image_info,created_at:l,link:c,fileName:s};alert("이미지를 성공적으로 업로드하였습니다!"),i(e=>e?[u,...e]:[u]),t(e=>({...e,imageLen:(null==e?void 0:e.imageLen)?e.imageLen+1:null==e?void 0:e.imageLen}))}catch(e){if(e instanceof a.d7){var n,r;(null===(n=e.response)||void 0===n?void 0:n.status)===401||(null===(r=e.response)||void 0===r?void 0:r.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지 업로드에 실패하였습니다..다시 시도해주세요")}else throw new s.U7}},b=async(e,t)=>{try{p(!0);let n=await (0,d.L)(),r=await o.Z.get("/room/".concat(e,"/imagelist?start=").concat(t,"&limit=").concat(12),{headers:{Authorization:n.access_token}}),i=r.data.imagelist,a=await u(i);return a.length<12&&m(!0),p(!1),a}catch(e){if(e instanceof a.d7){var n,r;(null===(n=e.response)||void 0===n?void 0:n.status)===401||(null===(r=e.response)||void 0===r?void 0:r.status)===403?console.error("Error: 올바른 요청이 아닙니다..다시시도 해주세요!"):console.error("Error: ","이미지를 불러오는데 실패하였습니다..다시 시도해주세요")}else throw new s.U7}},x=async(e,t)=>{try{let r=await (0,d.L)();await o.Z.delete("/room/".concat(e,"/image"),{headers:{Authorization:r.access_token},data:{delete_room_image_id:t}}),alert("이미지를 성공적으로 삭제하였습니다!"),n(e=>{if(!e)return null;let n=e.filter(e=>e.id!==t);return n})}catch(e){if(e instanceof a.d7){var r,i;(null===(r=e.response)||void 0===r?void 0:r.status)===401||(null===(i=e.response)||void 0===i?void 0:i.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지를 삭제하는데 실패하였습니다..다시 시도해주세요")}else throw new s.U7}},w=async(t,r)=>{var i,l,c;try{let a=await (0,d.L)(),l=await o.Z.post("/room/".concat(t,"/image"),r,{headers:{Authorization:a.access_token}}),c=l.data.image_info,s=null!==c.created_at?c.created_at.split(" ")[0]:null,u=window.URL.createObjectURL(new Blob([r.get("image")],{type:"multipart/form-data"})),f=c.link?c.link.split("/")[1]:"Image",p={...l.data.image_info,created_at:s,link:u,fileName:f,user_name:null===(i=e.user_info)||void 0===i?void 0:i.name};alert("이미지를 성공적으로 업로드하였습니다!"),n(e=>e?[p,...e]:[p])}catch(e){if(e instanceof a.d7)(null===(l=e.response)||void 0===l?void 0:l.status)===401||(null===(c=e.response)||void 0===c?void 0:c.status)===403?alert("올바른 요청이 아닙니다..다시시도 해주세요!"):alert("이미지 업로드에 실패하였습니다..다시 시도해주세요");else throw new s.U7}};return{isLoading:f,imageLoadEnd:h,setImageLoadEnd:m,loadUserImagelist:g,deleteUserImage:v,uploadUserImage:_,loadRoomImagelist:b,deleteRoomImage:x,uploadRoomImage:w}}},8718:function(e,t,n){var o=n(2265);t.Z=(e,t)=>{let n=(0,o.useRef)(null),r=(0,o.useCallback)((t,n)=>{t.forEach(t=>{t.isIntersecting&&e(t,n)})},[e]);return(0,o.useEffect)(()=>{if(!n.current)return;let e=new IntersectionObserver(r,t);return e.observe(n.current),()=>e.disconnect()},[t,r]),n}},4903:function(e,t,n){var o=n(9222);let r=o.default.create({baseURL:"https://codakcodak.site/backapi"});t.Z=r},6339:function(e,t,n){n.d(t,{F7:function(){return o},U7:function(){return r}});class o extends Error{constructor(e="연결되 네트워크가 없습니다."){super(e),this.name="NetworkError"}}class r extends Error{constructor(e="예기치 못한 에러가 발생하였습니다..다시 시도해주세요."){super(e),this.name="unknownError"}}},7262:function(e,t){t.Z={onSet(e,t){let n=JSON.stringify(t);localStorage.setItem(String(e),n)},onGet(e){var t;let n=null!==(t=localStorage.getItem(String(e)))&&void 0!==t?t:"null";try{return JSON.parse(n)}catch(e){return n}}}},5476:function(e,t,n){n.d(t,{H:function(){return r},W:function(){return i}});var o=n(6881);let r="@room/image",i=(0,o.MT)({key:"".concat(r,"-imagelist"),initial:null})},6494:function(e,t,n){n.d(t,{B1:function(){return i},EE:function(){return l},sB:function(){return a},v$:function(){return d},wy:function(){return c},zV:function(){return s},zW:function(){return u}});var o=n(6881),r=n(7262);let i="@user/token",a="@user/info",l="@user/room",c="@user/friend",s="@user/image",d=(0,o.MT)({key:a,initial:{loginState:"loading"},persistor:r.Z}),u=(0,o.MT)({key:"".concat(s,"-imagelist"),initial:null})},2472:function(e,t,n){n.d(t,{L:function(){return l}});var o=n(9222),r=n(2164),i=n(7262),a=n(6494);let l=async()=>{try{let e=new Date,t=i.Z.onGet(a.B1),n=null==t?void 0:t.access_token,r=null==t?void 0:t.refresh_token,l=null==t?void 0:t.access_token_expire_time,c=null==t?void 0:t.refresh_token_expire_time;if(!l||!c||!n)return null;let s=new Date(l),d=s.getTime()-e.getTime(),u=new Date(c),f=u.getTime()-e.getTime();if(d>=3e4)return t;if(!(f>=3e4))return null;{let e=i.Z.onGet(a.sB),n=null==e?void 0:e.user_info.id,l=await o.default.post("/backapi/user/".concat(n,"/refresh"),{refresh_token:r}),c=l.data;return i.Z.onSet(a.B1,{...t,...c}),c}}catch(e){return e instanceof r.d7?console.error("Error: 사용자 권한을 갱신하지 못하였습니다..",e):console.error("Error: ",e),null}}}}]);